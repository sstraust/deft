{"version":3,"sources":["deft/core.cljc"],"mappings":"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","names":["unused__11803__auto__","self__","G__43163","js/Error","args43162","cljs.core/aclone","this__5327__auto__","writer__5328__auto__","opt__5329__auto__","cljs.core/-write","deft.core/TypeMap","deft.core/->TypeMap","m","mta","_","k","cljs.core.get","default-value","v","cljs.core.assoc","cljs.core/contains?","cljs.core.dissoc","entry","cljs.core/vector?","cljs.core.nth","cljs.core.reduce","cljs.core/-conj","cljs.core/seq","cljs.core/count","new-mta","this","other","and__5041__auto__","o","cljs.core._EQ_","cljs.core/hash","writer","opts","cljs.core.pr_str","not-found","var_args","args__5772__auto__","len__5766__auto__","i__5767__auto__","argseq__5773__auto__","cljs.core/IndexedSeq","deft.core/check-implements","p__43167","map__43168","cljs.core/--destructure-map","seq43164","G__43165","cljs.core/first","cljs.core/next","G__43166","self__5751__auto__","obj-type","protocol","available-methods","cljs.core/set","undefined-methods","cljs.core.into","cljs.core.remove","cljs.core/nil?","cljs.core.map","p__43169","map__43170","key-fn","multimethod","method-def","or__5043__auto__","cljs.core/methods","cljs.core/empty?","deft.core/RuntimeException","deft.core/prefix-keys","ns-name","prefix-fn","cljs.core/Keyword","cljs.core.keyword","cljs.core/name","cljs.core/reduce-kv","acc"],"sourcesContent":["(ns deft.core\n  (:require [malli.core :as m]\n            #?(:clj [potemkin.collections :refer [def-map-type]])))\n\n#?(:clj\n   (def-map-type TypeMap [m mta]\n  (get [_ k default-value]\n       (if (contains? m k)\n         (get m k)\n         default-value))\n  (assoc [_ k v]\n    (TypeMap. (assoc m k v) mta))\n  (dissoc [_ k]\n          (if (contains? (:required-keys mta) k)\n            (dissoc m k)\n            (TypeMap. (dissoc m k) mta)))\n  (keys [_]\n    (keys m))\n  (meta [_]\n    mta)\n  (with-meta [_ mta]\n    (TypeMap. m mta)))\n   \n   :cljs\n   ;; ClojureScript implementation using deftype\n   (deftype TypeMap [m mta]\n     ILookup\n     (-lookup [_ k]\n       (get m k))\n     (-lookup [_ k default-value]\n       (get m k default-value))\n     \n     IAssociative\n     (-assoc [_ k v]\n       (TypeMap. (assoc m k v) mta))\n     (-contains-key? [_ k]\n       (contains? m k))\n     \n     IMap\n     (-dissoc [_ k]\n       (if (contains? (:required-keys mta) k)\n         (dissoc m k)\n         (TypeMap. (dissoc m k) mta)))\n     \n     ICollection\n     (-conj [_ entry]\n       (if (vector? entry)\n         (TypeMap. (assoc m (nth entry 0) (nth entry 1)) mta)\n         (reduce -conj (TypeMap. m mta) entry)))\n     \n     ISeqable\n     (-seq [_]\n       (seq m))\n     \n     ICounted\n     (-count [_]\n       (count m))\n     \n     IEmptyableCollection\n     (-empty [_]\n       (TypeMap. {} mta))\n     \n     ;; Metadata support\n     IMeta\n     (-meta [_]\n       mta)\n     \n     IWithMeta\n     (-with-meta [_ new-mta]\n       (TypeMap. m new-mta))\n     \n     ;; Equality\n     IEquiv\n     (-equiv [this other]\n       (and (instance? TypeMap other)\n            (let [^TypeMap o other] \n              (and (= m (.-m o))\n                   (= mta (.-mta o))))))\n     \n     IHash\n     (-hash [_]\n       (hash [m mta]))\n     \n     ;; Make it work with pr-str\n     IPrintWithWriter\n     (-pr-writer [_ writer opts]\n       (-write writer \"#deft.core.TypeMap\")\n       (-write writer (pr-str {:m m :mta mta})))\n     \n     ;; IFn for map-as-function behavior: (my-map :key)\n     IFn\n     (-invoke [this k]\n       (-lookup this k))\n     (-invoke [this k not-found]\n       (-lookup this k not-found))))\n\n\n(defn check-implements\n  \"Verify that a type T implements a protocol (as defined with defp).\n\n  A protocol is considered satisfied if, for every method in the protocol,\n  there exists a multimethod implementation with dispatch value T\n\n  [obj-type protocol & {:keys [available-methods]}]\n  obj-type: should be the _dispatch value_ that is used for multimethods.\n    for objects defined via deft, this is the _keyword_, so (deft Shape ...)\n    would result in ::Shape\n  protocol: the protocol to implement. If you define it with (defp Drawable ...)\n    it's the variable stored in Drawable\n  available-methods: a list of methods to restrict to. it's like saying, check\n    if this protocol is satisfied, but assume that we can only see the value of\n    these methods. It's useful for checking that all of the methods are defined in the same place\n    (and not sporadically). If its nil, then it does no extra filtering.\n  \"\n  [obj-type protocol & {:keys [available-methods]}]\n  (let [available-methods (when available-methods (set available-methods))\n        undefined-methods\n        (into []\n        (remove nil?\n                (map (fn [{::keys [key-fn multimethod] :as method-def}]\n                            (when (or (not (contains?\n                                        (methods multimethod)\n                                        (key-fn obj-type)))\n                                      (and available-methods\n                                           (not (contains? available-methods multimethod))))\n                              method-def))\n                     (::implements-methods protocol))))]\n    (if (not (empty? undefined-methods))\n      (throw (RuntimeException. (str \"methods \" undefined-methods \" is not defined for \" obj-type \" in protocol \" protocol)))\n      true)))\n\n\n(defn prefix-keys [ns-name m]\n  (let [prefix-fn (fn [k]\n                   (if (keyword? k)\n                     (keyword (name ns-name) (name k))\n                     k))]\n    (reduce-kv (fn [acc k v]\n                 (assoc acc (prefix-fn k) v))\n               {}\n               m)))\n  \n\n"]}